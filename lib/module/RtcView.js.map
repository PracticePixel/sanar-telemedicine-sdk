{"version":3,"names":["React","Component","View","RtcContainer","RtcEngine","VideoFrames","SanarContext","Connecting","SanarChat","RtcView","constructor","props","state","peerIds","joined","connecting","global","Call_Timer","componentWillUnmount","_engineRef","context","destroy","componentDidMount","notification","setPeerIds","setEngineRef","setVideoPaused","_engine","create","providerId","enableVideo","addListener","warn","console","log","err","uid","reason","elapsed","indexOf","setState","filter","id","channel","setTimeout","joinChannel","token","roomName","render","intialFrame","isChatEnabled","flex","position"],"sources":["RtcView.js"],"sourcesContent":["import React, { Component } from 'react';\nimport { View } from 'react-native'\nimport RtcContainer from './components/RtcContainer';\nimport RtcEngine from 'sanar-rtc';\nimport VideoFrames from './components/VideoFrames';\nimport SanarContext from './common/SanarContext';\nimport Connecting from \"./components/Connecting\";\nimport SanarChat from './SanarChat';\nexport default class RtcView extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            peerIds: [],\n            joined: false,\n            connecting: true\n        }\n        global.Call_Timer = 0;\n    }\n\n    static contextType = SanarContext\n\n    componentWillUnmount() {\n        const { _engineRef } = this.context\n        _engineRef.destroy();\n    }\n\n    async componentDidMount() {\n        const { notification, setPeerIds, setEngineRef, setVideoPaused } = this.context\n        const _engine = await RtcEngine.create(notification.providerId);\n        setEngineRef(_engine) //:- Setting engine ref to store\n\n        _engine.enableVideo();\n        _engine.addListener('Warning', (warn) => {\n            console.log('Warning', warn);\n        });\n\n        _engine.addListener('Error', (err) => {\n            console.log('Error', err);\n        });\n\n        _engine.addListener('RemoteVideoStateChanged', (uid, state, reason, elapsed) => {\n            console.log('RemoteVideoStats', uid, state, reason, elapsed);\n            if (reason == 5) {\n                setVideoPaused(true)\n            } else if (reason == 6) {\n                setVideoPaused(false)\n            }\n        });\n\n        _engine.addListener('UserJoined', (uid, elapsed) => {\n            console.log('UserJoined', uid, elapsed);\n            // If new user\n            if (this.state.peerIds.indexOf(uid) === -1) {\n                this.setState({\n                    peerIds: [...this.state.peerIds, uid]\n                })\n                setPeerIds(this.state.peerIds)\n            }\n            this.setState({ connecting: false })\n        });\n\n        _engine.addListener('UserOffline', (uid, reason) => {\n            console.log('UserOffline', uid, reason);\n            this.setState({\n                peerIds: this.state.peerIds.filter((id) => id !== uid)\n            })\n            setPeerIds(this.state.peerIds)\n        });\n\n        _engine.addListener('JoinChannelSuccess', (channel, uid, elapsed) => {\n            console.log('JoinChannelSuccess', channel, uid, elapsed);\n            this.setState({ joined: true });\n        });\n\n        setTimeout(() => {\n            _engine?.joinChannel(notification.token, notification.roomName, null, 0);\n        }, 1000);\n    }\n\n    render() {\n        const { intialFrame, isChatEnabled, notification } = this.context\n        const { joined, connecting } = this.state\n        if (joined) {\n            return (\n                <>\n                    <View style={{ flex: 1 }}>\n                        {isChatEnabled &&\n                            <SanarChat\n                                empId={'uid'}\n                                appointmentId={'apnt_id'}\n                                notification={notification}\n                                enable={isChatEnabled}\n                                onEndFlow={() => { }}\n                            />}\n                    </View>\n                    <View style={{ position: 'absolute' }}>\n                        {connecting ?\n                            <Connecting />\n                            :\n                            <RtcContainer>\n                                <VideoFrames isLocal={intialFrame} />\n                            </RtcContainer>\n                        }\n                    </View>\n                </>\n            );\n        } else {\n            return null;\n        }\n    }\n}\n"],"mappings":"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"}