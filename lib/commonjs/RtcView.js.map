{"version":3,"names":["RtcView","Component","constructor","props","state","peerIds","joined","connecting","componentWillUnmount","_engineRef","context","destroy","componentDidMount","notification","setPeerIds","setEngineRef","setVideoPaused","_engine","RtcEngine","create","providerId","enableVideo","addListener","warn","console","log","err","uid","reason","elapsed","indexOf","setState","filter","id","channel","setTimeout","joinChannel","token","roomName","render","intialFrame","isChatEnabled","width","height","position","zIndex","SanarContext"],"sources":["RtcView.js"],"sourcesContent":["import React, { Component } from 'react';\nimport { View } from 'react-native'\nimport RtcContainer from './components/RtcContainer';\nimport RtcEngine from 'react-native-agora';\nimport VideoFrames from './components/VideoFrames';\nimport SanarContext from './common/SanarContext';\nimport Connecting from \"./components/Connecting\";\nimport SanarChat from './SanarChat';\n\nexport default class RtcView extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            peerIds: [],\n            joined: false,\n            connecting: true\n        }\n    }\n\n    static contextType = SanarContext\n\n    componentWillUnmount() {\n        const { _engineRef } = this.context\n        _engineRef.destroy();\n    }\n\n    async componentDidMount() {\n        const { notification, setPeerIds, setEngineRef, setVideoPaused } = this.context\n        const _engine = await RtcEngine.create(notification.providerId);\n        setEngineRef(_engine) //:- Setting engine ref to store\n\n        _engine.enableVideo();\n        _engine.addListener('Warning', (warn) => {\n            console.log('Warning', warn);\n        });\n\n        _engine.addListener('Error', (err) => {\n            console.log('Error', err);\n        });\n\n        _engine.addListener('RemoteVideoStateChanged', (uid, state, reason, elapsed) => {\n            console.log('RemoteVideoStats', uid, state, reason, elapsed);\n            if (reason == 5) {\n                setVideoPaused(true)\n            } else if (reason == 6) {\n                setVideoPaused(false)\n            }\n        });\n\n        _engine.addListener('UserJoined', (uid, elapsed) => {\n            console.log('UserJoined', uid, elapsed);\n            // If new user\n            if (this.state.peerIds.indexOf(uid) === -1) {\n                this.setState({\n                    peerIds: [...this.state.peerIds, uid]\n                })\n                setPeerIds(this.state.peerIds)\n            }\n            this.setState({ connecting: false })\n        });\n\n        _engine.addListener('UserOffline', (uid, reason) => {\n            console.log('UserOffline', uid, reason);\n            this.setState({\n                peerIds: this.state.peerIds.filter((id) => id !== uid)\n            })\n            setPeerIds(this.state.peerIds)\n        });\n\n        _engine.addListener('JoinChannelSuccess', (channel, uid, elapsed) => {\n            console.log('JoinChannelSuccess', channel, uid, elapsed);\n            this.setState({ joined: true });\n        });\n\n        setTimeout(() => {\n            _engine?.joinChannel(notification.token, notification.roomName, null, 0);\n        }, 1000);\n    }\n\n    render() {\n        const { intialFrame, isChatEnabled, notification } = this.context\n        const { joined, connecting } = this.state\n        if (joined) {\n            return (\n                <View style={{ width: '100%', height: '100%' }}>\n                    <View style={{ position: 'absolute', zIndex: 99999 }}>\n                        {connecting ?\n                            <Connecting />\n                            :\n                            <RtcContainer>\n                                <VideoFrames isLocal={intialFrame} />\n                            </RtcContainer>\n                        }\n                    </View>\n                    <SanarChat\n                        empId={'uid'}\n                        appointmentId={'apnt_id'}\n                        notification={notification}\n                        enable={isChatEnabled}\n                        onEndFlow={() => {}}\n                    />\n                </View>\n            );\n        } else {\n            return null;\n        }\n    }\n}\n"],"mappings":"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"}